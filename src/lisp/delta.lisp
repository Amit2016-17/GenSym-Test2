;; -*- Mode: Lisp; Package: AB; Base: 10; Syntax: Common-Lisp -*-
(in-package "AB")
 
;;;; Module DELTA

;;; Copyright (c) 1986 - 2017 Gensym Corporation.
;;; All Rights Reserved.

;;; Mark David, John Hodgkinson, and Ong, Peng Tsin



;;;; System Versions and the Gensym Product Line


;;; At present, several "systems" embody "products", and each such system is an
;;; element of the variable `systems-in-gensym-product-line'.  At present, it
;;; contains ab, telewindows, and gsi, which correspond to the "products" G2,
;;; Telewindows, and GSI, respectively.
;;;
;;; These products are kept in synch with the exact same system version, which
;;; is based on the following constants:
;;; 
;;;   `major-version-number-of-current-gensym-product-line'
;;;
;;;   `minor-version-number-of-current-gensym-product-line'
;;;
;;;   `release-quality-of-current-gensym-product-line'
;;;
;;;   `revision-number-of-current-gensym-product-line'
;;;
;;;
;;; If at some time it becomes necessary to bifdurcate the versions of various
;;; elements of the Gensym product line, code will have to be rewritten below to
;;; support that.  For now, it suffices to merely change one of these constants
;;; in order to change the version of the entire product line.

;;; The build-identification-string should be changed each time we do a build.
;;; It should be changed to use a letter for the month, and then have the two
;;; digit day of the month.  The letters are A=Jan, B=Feb, C=Mar, D=Apr, E=May,
;;; F=Jun, G=Jul, H=Aug, I=Sep, J=Oct, K=Nov, and L=Dec.  So a build on September
;;; 19th would have an identification string of "I19".

;;; The minor version number is considered to be "hundredths", so minor version
;;; 1, for example, prints as "X.01" rather than "X.1".  If we want it to 
;;; say "4.1", for example, the minor version number needs to be set to 10.

;;; The following line is for unix grepping to obtain the current
;;; version.  It should be kept up to date with the numbers below.
;;; G2, TW, GSI Version V8.4r3

;;; N.b. Any changes to the set of elements that comprise a version of G2
;;; should be reflected in the function that packages them into a structure
;;; for the system procedure g2-get-version. See file-sysproc.

(eval-when (:compile-toplevel :load-toplevel :execute)

;;; Change G2 major version only for major releases:
;;;
;;;  8 is for G2 8.x
;;; 11 is for G2 2011
;;; 12 is for G2 2015
(defconstant major-version-number-of-current-gensym-product-line 12)

;;; Never change G2 minor version, because it will also change the installer bundle key
;;; and many other things, too dangerous.
(defconstant minor-version-number-of-current-gensym-product-line 0)

;;; We use `release-quality' for public releases, which are done
;;; monthly, in general. For our internal releases, which are done
;;; weekly, in general, we use `beta-release-quality'. For other
;;; possible values, seee bootstrap.lisp.
(defconstant release-quality-of-current-gensym-product-line beta-release-quality)

;;; Change (increment) the following revision in each release (in
;;; general, once a month), also see
;;; `twrite-system-version-in-g2-title'. Start with 1 for a new major
;;; version.
(defconstant revision-number-of-current-gensym-product-line 20)

;;; `Patch number' can be NIL or positive integer, currently we don't use it.
(defconstant patch-number-of-current-gensym-product-line? nil)

;;; `External version' is used for G2 start block, change it only with major version.
(defconstant external-version 2015)

) ; end of EVAL-WHEN

(defparameter build-identification-string "TH27")

;; This is generated by "ant update_gensym_build_version", the current month
;; when building the installer, in format "YYYY.mm", no need to modify manually.

(defparameter build-comment-string "2017.08.W0")

(defvar system-version-of-current-gensym-product-line
  (make-system-version
   major-version-number-of-current-gensym-product-line
    minor-version-number-of-current-gensym-product-line
    :quality release-quality-of-current-gensym-product-line
    :revision revision-number-of-current-gensym-product-line
    :patch patch-number-of-current-gensym-product-line?
    :machine-model (machine-model)))

(defvar systems-in-gensym-product-line
  '(telewindows ab gsi gw))

(dolist (system systems-in-gensym-product-line)
  (set-system-version
    system
    system-version-of-current-gensym-product-line))
